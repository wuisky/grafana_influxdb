# Docker compose to run multiple influxdb instances on one machine
version: '3'
services:
  default_influxdb:
    #restart: always
    #network_mode: host
    image: influxdb:1.8
    volumes:
      - ./influxdb-docker.conf:/etc/influxdb/influxdb.conf:ro
      - /var/lib/influxdb/default_influxdb:/var/lib/influxdb
    ports:
      # - "8083:8083"
      - "8086:8086"

  # nginx:
  #   restart: always
  #   image: nginx:1.20
  #   network_mode: host
  #   ports:
  #     - "80:80"
  #   volumes:
  #     - ./nginx-default.conf:/etc/nginx/conf.d/default.conf
  #     - ./index.html:/var/www/html/index.html

  grafana:
    # restart: always
    image: grafana/grafana:9.0.3
    # network_mode: host
    ports:
      - "3000:3000"
    volumes:
      - /var/lib/grafana:/var/lib/grafana
    user: "0"
    depends_on:
      - default_influxdb
    #   - mysql
    environment:
      - GF_INSTALL_PLUGINS=https://github.com/cloudspout/cloudspout-button-panel/releases/download/7.0.23/cloudspout-button-panel.zip;cloudspout-button-panel

  # telegraf:
  #   image: telegraf:latest
  #   container_name: telegraf
  #   restart: always
  #   volumes:
  #     - ./telegraf.conf:/etc/telegraf/telegraf.conf:ro
  #     - /:/hostfs:ro
  #   environment:
  #     HOST_ETC: /hostfs/etc
  #     HOST_PROC: /hostfs/proc
  #     HOST_SYS: /hostfs/sys
  #     HOST_VAR: /hostfs/var
  #     HOST_RUN: /hostfs/run
  #     HOST_MOUNT_PREFIX: /hostfs
  #   ports:
  #     - "8092:8092/udp"
  #   depends_on:
  #     - default_influxdb

  # mysql:
  #   restart: always
  #   image: mysql/mysql-server:8.0.27
  #   network_mode: host
  #   ports:
  #     - "3306:3306"
  #   environment:
  #     - MYSQL_ROOT_PASSWORD=grafana
  #     - MYSQL_USER=wu
  #     - MYSQL_PASSWORD=grafana
  #     - MYSQL_DATABASE=grafana
  #   volumes:
  #     - /var/lib/mysql:/var/lib/mysql